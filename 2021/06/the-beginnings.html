<!DOCTYPE html>
<head>
  <title>GSoC Update - Week 1 ðŸš€ - pulsar17's blog</title>
  <meta charset='utf-8'/>
  <meta content='width=device-width, initial-scale=1' name='viewport'/>
    <meta rel='canonical' href='/2021/06/the-beginnings'/>
      <link rel='stylesheet' href='/theme/css/main.css'/>
</head>

<body itemscope itemtype='https://schema.org/WebPage' itemref='publisher-name publisher-description'>
  <div id='header'>
    <div class='handle'><span class='dots'></span></div>
    <div class='content'>
      <div itemscope itemtype='https://schema.org/Organization' itemid=''>
        <header id='publisher'>
          <h1><a itemprop='url' rel='home' href=''><span itemprop='name' id='publisher-name'>pulsar17&#39;s blog</span></a></h1>
        </header>
      </div>


<nav itemscope itemtype='https://schema.org/SiteNavigationElement'>
  <div class='container'>
    <div class='handle'>(Pages)</div>
    <div class='content'>
        (<span itemprop='name'><a itemprop='url' href='/tags.html' >Tags</a></span>)
        (<span itemprop='name'><a itemprop='url' href='/authors.html' >Authors</a></span>)
        (<span itemprop='name'><a itemprop='url' href='/archives.html' >Archives</a></span>)
    </div>
  </div>

    <div class='container' id='nav-categories-container'>
      <div class='handle'>
        {<span itemprop='name'><a itemprop='url' href='/categories/index.html'>Categories</a></span>}
      </div>
      <div class='content'>
          <span itemprop='name' class='category'><a itemprop='url' href='/categories/unrelated' >Unrelated</a></span>
          <span itemprop='name' class='category'><a itemprop='url' href='/categories/gsoc' class='active'>GSoC</a></span>
      </div>
    </div>

  <div class='container' id='nav-breadcrumb-container'>
    <div class='handle'>&gt;</div>
    <div class='content'>


<div itemscope itemtype='https://schema.org/BreadcrumbList'>
      <span itemprop='itemListElement' itemscope itemtype='http://schema.org/ListItem'>
    <a itemprop='item' href='/2021/06/the-beginnings.html'><span itemprop='name'>GSoC Update - Week 1 ðŸš€</span></a>
    <meta itemprop='position' content='4'/>
  </span>
  &lt;

      <span itemprop='itemListElement' itemscope itemtype='http://schema.org/ListItem'>
    <a itemprop='item' href='/categories/gsoc.html'><span itemprop='name'>GSoC</span></a>
    <meta itemprop='position' content='3'/>
  </span>
  &lt;

      <span itemprop='itemListElement' itemscope itemtype='http://schema.org/ListItem'>
    <a itemprop='item' href='/categories/'><span itemprop='name'>Categories</span></a>
    <meta itemprop='position' content='2'/>
  </span>
  &lt;

    <span itemprop='itemListElement' itemscope itemtype='https://schema.org/ListItem'>
    <meta itemprop='name' content='Home'/>
    <span itemprop='item' itemscope itemtype='https://schema.org/Blog'>
      <meta itemprop='name' content='pulsar17&#39;s blog'/>
      <a itemprop='url' href=''>Home</a>
    </span>
    <meta itemprop='position' content='1'/>
  </span>

</div>

<div itemscope itemtype='https://schema.org/BreadcrumbList'>
      <span itemprop='itemListElement' itemscope itemtype='http://schema.org/ListItem'>
    <a itemprop='item' href='/2021/06/the-beginnings.html'><span itemprop='name'>GSoC Update - Week 1 ðŸš€</span></a>
    <meta itemprop='position' content='5'/>
  </span>
  &lt;


        15
        &lt;
          <span itemprop='itemListElement' itemscope itemtype='http://schema.org/ListItem'>
    <a itemprop='item' href='/2021/06/'><span itemprop='name'>June</span></a>
    <meta itemprop='position' content='3'/>
  </span>
  &lt;

          <span itemprop='itemListElement' itemscope itemtype='http://schema.org/ListItem'>
    <a itemprop='item' href='/2021/'><span itemprop='name'>2021</span></a>
    <meta itemprop='position' content='2'/>
  </span>
  &lt;

    <span itemprop='itemListElement' itemscope itemtype='https://schema.org/ListItem'>
    <meta itemprop='name' content='Home'/>
    <span itemprop='item' itemscope itemtype='https://schema.org/Blog'>
      <meta itemprop='name' content='pulsar17&#39;s blog'/>
      <a itemprop='url' href=''>Home</a>
    </span>
    <meta itemprop='position' content='1'/>
  </span>

</div>    </div>
  </div>
</nav>    </div>
  </div>

  <main>

    <article itemprop='mainEntity' itemscope itemtype='https://schema.org/BlogPosting'>
    <meta itemprop='headline' content='GSoC Update - Week 1 ðŸš€'/>
    <link itemprop='publisher' itemscope itemtype='https://schema.org/Organization' itemref='publisher' href=''/>
    <link itemprop='mainEntityOfPage' href='/2021/06/the-beginnings'/>
    <meta itemprop='inLanguage' content='en'/>
      <meta itemprop='wordCount' content='1648'/>


    <header>
      <h2 itemprop='name'><a href='/2021/06/the-beginnings'>GSoC Update - Week 1 ðŸš€</a></h2>
      <p>
        <time itemprop='datePublished' datetime='2021-06-15 00:40:00+05:30' title='2021-06-15 00:40:00+05:30'>Tue 15 June 2021</time>
          *
          <time itemprop='dateModified' datetime='2021-06-20 00:01:00+05:30' title='2021-06-20 00:01:00+05:30'>Sun 20 June 2021</time>
      </p>
      <p class='author-cat-tag'>
            <span itemprop='author' itemscope itemtype='https://schema.org/Person' class='author'>
    <span itemprop='name' class='name'><a itemprop='url' rel='author' href='/author/ishaan-arora.html'>Ishaan Arora</a></span>
  </span>


          <span itemprop="articleSection" class='category'><a href='/categories/gsoc'>GSoC</a></span>


            <span itemprop="keywords" class='tag'><a href='/tags/python'>python</a></span>

            <span itemprop="keywords" class='tag'><a href='/tags/django'>django</a></span>

            <span itemprop="keywords" class='tag'><a href='/tags/inkscape'>inkscape</a></span>

      </p>
    </header>

      <meta itemprop='description' content='This is what I did in the first week of GSoC'>
      <div>
        <div class="section" id="before-the-coding-period-for-context">
<h2>Before The Coding Period (For context)</h2>
<p>My exams were to start on 7th June. Knowing that, I started working a week or so before. Mind you, I am fairly new to Django - with no experience in Web Development. I knew that this was going to be a hurdle for me, so I started a little early to compensate for my lack of experience and the time required for my exams.</p>
<p>I created custom Django TestCase classes so that I could easily test views, then wrote some tests, learned some Vim shortcuts.</p>
<p>I had some trouble initially when I was trying to test a view that created comments on the Inkscape Forum <a class="footnote-reference" href="#forum" id="id1">[1]</a> using Django's Test Client. To me, it should have been a simple matter of passing a POST request to a URL. Turns out, <em>django_comments</em>, the package the website uses for comments, does some special things under the hood for security reasons (which I won't go into too much detail). It <em>attaches</em> some security information to the form and sets that info as <tt class="docutils literal">type=hidden</tt> in the HTML so that the browser sends it back to the backend. It works in the browser because the browser first sends a GET request on the URL, which renders an empty form. The form has those <tt class="docutils literal">hidden</tt> inputs. It has the complete state essentially for the browser to send a complete valid POST request.</p>
<p>Since I was using the Django Test Client, I could only send a POST or a GET request to that URL ( I could theoretically send a GET request first, then parse the HTML to extract those fields, and then send the POST request... ) but no, I was adamant in doing it the browser way. I blatantly suggested to my mentor, Martin that we should use Selenium for these tests...</p>
<p>He politely asked me to send that extra information in the POST data itself instead of adding Selenium as a dependency. Little do you know when you want to add yet another dependency for no prominent reason. You can go as deep as you want in that rabbit hole ðŸ˜‰  <a class="footnote-reference" href="#maybe" id="id2">[2]</a> (Why not add <tt class="docutils literal">numpy</tt> while we're at it?)</p>
<p>Now, the problem was - how to retrieve that security data?</p>
<p>Anyways, this was before the coding period.</p>
</div>
<div class="section" id="the-coding-period-begins">
<h2>The Coding Period Begins</h2>
<div class="line-block">
<div class="line">So, the coding period officially started on 7th of June. (Should have made this update on 13th of June, anyways...)</div>
<div class="line">I figured out a way, it wasn't very pretty but worked. I could now test forms*, yay! (If you're wondering what was it, it was an internal method <tt class="docutils literal">get_security_data()</tt> that <em>django_comments</em> uses. I had to go into the source to dig this method out... but it was worth it)</div>
<div class="line">* I should be clear here that I am not testing the forms currently but views that use those forms.</div>
</div>
<div class="section" id="mocking-and-patching">
<h3>Mocking and Patching</h3>
<p>I also looked into Mocking and Patching this week. Basically, mocks are <em>blank</em> stubs that you can substitute for real objects while testing. They are an extremely handy tool. You can mock almost anything (almost... more on this later) - databases, external APIs, UFOs ðŸ˜‰... Mocks are part of the Python standard library, present in the <tt class="docutils literal">unittest</tt> testing framework. So, mocks are stubs and you replace real objects with them using <strong>patching</strong> (also a part of <tt class="docutils literal">unittest</tt>).</p>
<div class="line-block">
<div class="line"><em>Why you might ask was I looking for that?</em></div>
<div class="line">Testing obviously ðŸ˜€</div>
</div>
<p>The need was to mock and patch <tt class="docutils literal">datetime.now()</tt> for a test. This test was going through all the topics in a forum and filtering the topics which were created in last <tt class="docutils literal">n</tt> number of days. Since test data is static, the tests run on data you created a month ago will show different results when you run <tt class="docutils literal">datetime.now()</tt>, well, now. You might get a false sense of test correctness when you run them now but after a month, a year, those tests will suddenly start to fail. I hope I was able to convince you that the need for mocking dates in tests is real.</p>
<p>Turns out it is hard, real hard to mock <tt class="docutils literal">datettime.now()</tt>, especially when using third party code like Django.
I won't go into the details of why it is so, there are some great articles about that. I'll link to them in the footnotes.</p>
<p>With my novice Python skills, I came up with a solution of my own:</p>
<pre class="code python literal-block">
<span class="kn">from</span> <span class="nn">contextlib</span> <span class="kn">import</span> <span class="n">contextmanager</span>

<span class="nd">&#64;contextmanager</span>
<span class="k">def</span> <span class="nf">freeze</span><span class="p">(</span><span class="n">datetime_module</span><span class="p">,</span> <span class="n">set_to</span><span class="p">):</span>
        <span class="n">patcher</span> <span class="o">=</span> <span class="n">mock</span><span class="o">.</span><span class="n">patch</span><span class="o">.</span><span class="n">object</span><span class="p">(</span>
        <span class="n">datetime_module</span><span class="p">,</span> <span class="s1">'datetime'</span><span class="p">,</span> <span class="n">mock</span><span class="o">.</span><span class="n">Mock</span><span class="p">(</span><span class="n">wraps</span><span class="o">=</span><span class="n">datetime_module</span><span class="o">.</span><span class="n">datetime</span><span class="p">)</span>
        <span class="p">)</span>
        <span class="n">mocked_date</span> <span class="o">=</span> <span class="n">patcher</span><span class="o">.</span><span class="n">start</span><span class="p">()</span>
        <span class="n">mocked_date</span><span class="o">.</span><span class="n">now</span><span class="o">.</span><span class="n">return_value</span> <span class="o">=</span> <span class="n">set_to</span>
        <span class="k">yield</span>
        <span class="n">patcher</span><span class="o">.</span><span class="n">stop</span><span class="p">()</span>
</pre>
<p>Then you would use it as:</p>
<pre class="code python literal-block">
<span class="kn">import</span> <span class="nn">datetime</span>

<span class="k">def</span> <span class="nf">test_view_displays_topics_from_last_week</span><span class="p">():</span>
        <span class="k">with</span> <span class="n">freeze</span><span class="p">(</span><span class="n">datetime</span><span class="p">,</span> <span class="n">set_to</span><span class="o">=</span><span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="p">(</span><span class="mi">2021</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">8</span><span class="p">):</span>
                <span class="c1"># do actual work</span>
                <span class="k">pass</span>
</pre>
<div class="line-block">
<div class="line">Pretty neat, isn't it ðŸ˜Ž ?</div>
<div class="line">Except that it <strong>doesn't</strong> work (<em>in some cases</em>). ðŸ™ƒ</div>
<div class="line">Here's why -</div>
</div>
<pre class="code python literal-block">
<span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="n">datettime</span><span class="o">.</span><span class="n">datetime</span><span class="p">)</span>
</pre>
<p>The problem is that the only way that the <tt class="docutils literal">datetime.now()</tt> method can be patched is if we mock the parent <tt class="docutils literal">datetime</tt> class. That is <tt class="docutils literal">datetime.datetime</tt>. In doing so, we essentially replace <tt class="docutils literal">datetime.datetime</tt> with an instance of <tt class="docutils literal">Mock</tt> class.</p>
<p>So, now roughly</p>
<pre class="code python literal-block">
<span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span> <span class="o">==</span> <span class="n">Mock</span><span class="p">()</span>
</pre>
<p>Those <tt class="docutils literal">isinstance</tt> checks will now fail when the <tt class="docutils literal">value</tt> argument is a real <tt class="docutils literal">datetime.datetime</tt> object. Since it would be asking if a date is an instance of a <tt class="docutils literal">Mock</tt> instance (yes, an instance, not even a class!).</p>
<div class="line-block">
<div class="line">These shenanigans arise because a Mocked object is being used as the second argument in <tt class="docutils literal">isinstance</tt> where a proper <em>Class</em> should be used. And since this is third party code (Django in my case), there isn't really much you can do about it.</div>
<div class="line">Those <tt class="docutils literal">isinstance</tt> checks lie sprinkled here and there, while you just ponder over the meaning of life...</div>
</div>
<div class="section" id="so-what-s-the-solution-then">
<h4><em>So, what's the solution then?</em></h4>
<div class="line-block">
<div class="line"><strong>None</strong>. Atleast I couldn't find one... And yes, I looked at SO answers, many articles alike. I just couldn't find a solution. These were the limits of my <em>novice Pythonista</em> mind that were being tested.</div>
<div class="line">If you're not using third party code though, and don't want to use a library like Freezegun (yes, I should have told that earlier. A library exists solely for patching datetimes), by all means use the one solution that I provided ðŸ˜‰</div>
</div>
</div>
</div>
<div class="section" id="gsoc-mentors-and-mentees-meet-g3m">
<h3>GSoC Mentors and Mentees Meet (G3M)</h3>
<p>We had our first G3M (I gave it that name, it's not official) on 11th June. All the mentors introduced themselves and told us about their backgrounds and what part of Inkscape they work on. Then students told about what they're doing currently, which university/school they're from and what project they will be doing for GSoC (We also have one project from Outreachy). There are many interesting projects this year - on canvas bool ops, markers, alignment guides, actions improvements, etc.</p>
<p>In the meeting, Marc, one of the developers, suggested us to write blogs, and communicate regularly with our mentors about our work. This G3M was scheduled on a <abbr title="Big Blue Button">BBB</abbr> instance. This is how all the developers usually communicate. That, the RocketChat instance and <abbr title="Internet Relay Chat">IRC</abbr> are the modes at our disposal.
We were also told that we will be having more such G3Ms in the future.</p>
<p>This was a fun experience. I got to know about the people who develop Inkscape. Together with the community they create an awesome piece of software that is Inkscape. I am glad I chose Inkscape as my org.</p>
</div>
<div class="section" id="final-thoughts">
<h3>Final Thoughts</h3>
<p>This week was a light one with respect to how much I could do. I learned many new things and got to know such great people. I hope I will be able to contribute more in the coming weeks.</p>
<div class="section" id="bonus-tip-just-grep-it">
<h4>Bonus Tip: Just Grep It!</h4>
<p>If you are trying to find correlations between how a thing is done in the codebase, an intuitive way is to search for it. Should you use your IDE's search? Nah... I found VSCodium's search to be ineffective sometimes so I have given up on it. Instead, I use this:</p>
<pre class="code sh literal-block">
grep -Rin <span class="s2">&quot;?next&quot;</span> .
</pre>
<p><strong>Example output for this search.</strong></p>
<pre class="code literal-block">
./content/second.rst:121:        grep -Rin &quot;?next&quot; .
./content/second.rst:132:        grep -i &quot;?next&quot; $(find . -print) 2&gt;/dev/null
./output/2021/06/the-beginnings.html:244:grep -Rin &lt;span class=&quot;s2&quot;&gt;&amp;quot;?next&amp;quot;&lt;/span&gt; .
./output/2021/06/the-beginnings.html:255:grep -i &lt;span class=&quot;s2&quot;&gt;&amp;quot;?next&amp;quot;&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;$(&lt;/span&gt;find . -print&lt;span class=&quot;k&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;2&lt;/span&gt;&amp;gt;/dev/null
</pre>
<div class="line-block">
<div class="line">This is a trick I learned from one of Martin's videos <a class="footnote-reference" href="#vid" id="id3">[5]</a> (He has a YouTube channel!)</div>
<div class="line">The important thing here are the options, <tt class="docutils literal"><span class="pre">-R</span></tt> is for recursive search, <tt class="docutils literal"><span class="pre">-i</span></tt> is for case insensitiveness, <tt class="docutils literal"><span class="pre">-n</span></tt> is for displaying line numbers along with the filename.</div>
</div>
<div class="line-block">
<div class="line">Super super useful. I can't stress enough the importance of this one command ðŸ˜€</div>
</div>
<p>Before I knew this command, I used to use this:</p>
<pre class="code sh literal-block">
grep -i <span class="s2">&quot;?next&quot;</span> <span class="k">$(</span>find . -print<span class="k">)</span> <span class="m">2</span>&gt;/dev/null
</pre>
<div class="line-block">
<div class="line">An abomination (still somewhat UNIXy though) which would make the GNU/Gods frown ...</div>
<div class="line">Not to mention, how awfully slow it is.</div>
</div>
<p>Anyways, that's all I have to say for now, adieu...</p>
<blockquote>
<div class="line-block">
<div class="line"><em>Too many mountains to climb</em></div>
<div class="line"><em>Too many thoughts for my pen to write...</em></div>
<div class="line"><br /></div>
<div class="line">- <em>Too Many, Winterbourne</em></div>
</div>
</blockquote>
<p class="rubric"><strong>Footnotes</strong></p>
<table class="docutils footnote" frame="void" id="forum" rules="none">
<colgroup><col class="label" /><col /></colgroup>
<tbody valign="top">
<tr><td class="label"><a class="fn-backref" href="#id1">[1]</a></td><td><a class="reference external" href="https://inkscape.org/forums/">Inkscape Forum</a>: If you haven't checked it out, have a look, there's lots of cool things the community has shared.</td></tr>
</tbody>
</table>
<table class="docutils footnote" frame="void" id="maybe" rules="none">
<colgroup><col class="label" /><col /></colgroup>
<tbody valign="top">
<tr><td class="label"><a class="fn-backref" href="#id2">[2]</a></td><td>I have nothing against Selenium, I have everything against my tendency to complicate things when things can be simpler. Selenium is an excellent tool, I was going for the chainsaw instead of a knife.</td></tr>
</tbody>
</table>
<table class="docutils footnote" frame="void" id="article1" rules="none">
<colgroup><col class="label" /><col /></colgroup>
<tbody valign="top">
<tr><td class="label">[3]</td><td><a class="reference external" href="https://nedbatchelder.com/blog/201209/mocking_datetimetoday.html">https://nedbatchelder.com/blog/201209/mocking_datetimetoday.html</a> - Ned Batchelder talks about his need to mock <tt class="docutils literal">today()</tt>, similar to my need to mock <tt class="docutils literal">now()</tt>.</td></tr>
</tbody>
</table>
<table class="docutils footnote" frame="void" id="article2" rules="none">
<colgroup><col class="label" /><col /></colgroup>
<tbody valign="top">
<tr><td class="label">[4]</td><td><a class="reference external" href="http://lists.idyll.org/pipermail/testing-in-python/2011-July/004296.html">http://lists.idyll.org/pipermail/testing-in-python/2011-July/004296.html</a> A conversation with Michael Foord - the original author of mock, that highlights exactly the problem I was having.</td></tr>
</tbody>
</table>
<table class="docutils footnote" frame="void" id="vid" rules="none">
<colgroup><col class="label" /><col /></colgroup>
<tbody valign="top">
<tr><td class="label"><a class="fn-backref" href="#id3">[5]</a></td><td><a class="reference external" href="https://youtu.be/FEQstRH73WI">https://youtu.be/FEQstRH73WI</a> - A great learning resource. Teaches how to navigate/search a big codebase such as Inkscape. The thought process is the most important takeaway from this video.</td></tr>
</tbody>
</table>
</div>
</div>
</div>

      </div>
  </article>

  </main>


  <footer>
<!-- Proudly powered by Pelican which takes great advantage of Python, with Apricot theme (v0.1.0) by Yu-Jie Lin. -->

  </footer>
</body>